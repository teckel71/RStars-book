<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>5 Análisis previo de datos. | R-Stars: La Guía</title>
<meta name="author" content="Miguel-Ángel Tarancón">
<meta name="description" content="5.1 Introducción. Antes de la aplicación de técnicas complejas que permitan extraer de los datos conclusiones relevantes, es necesario realizar unas tareas previas destinadas a conseguir dos...">
<meta name="generator" content="bookdown 0.44 with bs4_book()">
<meta property="og:title" content="5 Análisis previo de datos. | R-Stars: La Guía">
<meta property="og:type" content="book">
<meta property="og:url" content="https://teckel71.github.io/RStars-book/análisis-previo-de-datos..html">
<meta property="og:image" content="https://teckel71.github.io/RStars-book/figuras/Portada_v3-2.jpg">
<meta property="og:description" content="5.1 Introducción. Antes de la aplicación de técnicas complejas que permitan extraer de los datos conclusiones relevantes, es necesario realizar unas tareas previas destinadas a conseguir dos...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="5 Análisis previo de datos. | R-Stars: La Guía">
<meta name="twitter:description" content="5.1 Introducción. Antes de la aplicación de técnicas complejas que permitan extraer de los datos conclusiones relevantes, es necesario realizar unas tareas previas destinadas a conseguir dos...">
<meta name="twitter:image" content="https://teckel71.github.io/RStars-book/figuras/Portada_v3-2.jpg">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><link href="libs/Inter-0.4.10/font.css" rel="stylesheet">
<link href="libs/JetBrains_Mono-0.4.10/font.css" rel="stylesheet">
<link href="libs/Inter_Tight-0.4.10/font.css" rel="stylesheet">
<script src="libs/bs3compat-0.9.0/transition.js"></script><script src="libs/bs3compat-0.9.0/tabs.js"></script><script src="libs/bs3compat-0.9.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
          margin-bottom: 0em;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="assets/styles.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">R-Stars: La Guía</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"></a></li>
<li><a class="" href="prefacio.html">Prefacio</a></li>
<li><a class="" href="introducci%C3%B3n..html"><span class="header-section-number">1</span> Introducción.</a></li>
<li><a class="" href="almacenando-y-manipulando-datos..html"><span class="header-section-number">2</span> Almacenando y manipulando datos.</a></li>
<li><a class="" href="gr%C3%A1ficos..html"><span class="header-section-number">3</span> Gráficos.</a></li>
<li><a class="" href="estad%C3%ADstica-descriptiva..html"><span class="header-section-number">4</span> Estadística descriptiva.</a></li>
<li><a class="active" href="an%C3%A1lisis-previo-de-datos..html"><span class="header-section-number">5</span> Análisis previo de datos.</a></li>
<li><a class="" href="componentes-principales..html"><span class="header-section-number">6</span> Componentes principales.</a></li>
<li><a class="" href="an%C3%A1lisis-cl%C3%BAster..html"><span class="header-section-number">7</span> Análisis Clúster.</a></li>
<li><a class="" href="an%C3%A1lisis-de-la-varianza..html"><span class="header-section-number">8</span> Análisis de la varianza.</a></li>
<li><a class="" href="an%C3%A1lisis-de-regresi%C3%B3n-lineal-m%C3%BAltiple..html"><span class="header-section-number">9</span> Análisis de Regresión Lineal Múltiple.</a></li>
<li><a class="" href="an%C3%A1lisis-de-datos-cualitativos..html"><span class="header-section-number">10</span> Análisis de Datos Cualitativos.</a></li>
<li><a class="" href="bibliograf%C3%ADa.html">Bibliografía</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="análisis-previo-de-datos." class="section level1" number="5">
<h1>
<span class="header-section-number">5</span> Análisis previo de datos.<a class="anchor" aria-label="anchor" href="#an%C3%A1lisis-previo-de-datos."><i class="fas fa-link"></i></a>
</h1>
<div id="introducción.-1" class="section level2" number="5.1">
<h2>
<span class="header-section-number">5.1</span> Introducción.<a class="anchor" aria-label="anchor" href="#introducci%C3%B3n.-1"><i class="fas fa-link"></i></a>
</h2>
<p>Antes de la aplicación de técnicas complejas que permitan extraer de los datos conclusiones relevantes, es necesario realizar unas <strong>tareas previas</strong> destinadas a conseguir dos objetivos:</p>
<ul>
<li><p><strong>Preparar nuestros datos</strong> para que puedan ser procesados correctamente sin provocar distorsiones en los resultados.</p></li>
<li><p>Obtener una <strong>visión inicial de la información</strong> que esconden los datos, fundamentalmente en cuanto a las medidas básicas que caracterizan la distribución de frecuencias de las variables en las que se estructuran estos, así como, en el caso de contar con más de una variable, de las relaciones estadísticas que existen entre ellas.</p></li>
</ul>
<p>Además, es preciso tener en cuenta que, usualmente, es conveniente que estos rasgos iniciales que caracterizan a nuestra muestra o población sean plasmados de un modo <strong>visualmente amigable</strong>, claro y conciso.</p>
<p>En esta práctica, por medio de un ejemplo basado en información económico-financiera de una muestra constituida por 100 empresas dedicadas a la producción de electricidad mediante tecnología eólica, se mostrarán una serie de buenas prácticas y análisis básicos útiles a la hora de preparar y analizar inicialmente nuestro conjunto de datos.</p>
<p>Vamos a suponer que trabajamos dentro de un <strong>proyecto</strong> que hemos creado previamente, de nombre “explora”. Dentro de la carpeta del proyecto guardaremos el <em>script</em> llamado “<a href="https://drive.google.com/file/d/1VqZX81h15JZhF7KXXj3alLd08o5ywkX2/view?usp=sharing">explora_describe.R</a>”, y el archivo de Microsoft® Excel® llamado “<a href="https://docs.google.com/spreadsheets/d/1f9KV5epNpBRM6v9sKPtgFDkzMlOo75Y2/edit?usp=sharing&amp;ouid=115375878280465826079&amp;rtpof=true&amp;sd=true">eolica_100_mv.xlsx</a>”. Si abrimos este último archivo, comprobaremos que se compone de tres hojas. La primera muestra un mensaje sobre el uso de los datos, la segunda recoge la descripción de las variables consideradas, y la tercera (hoja “Datos”) almacena los datos que debemos importar. Estos datos se corresponden con diferentes variables económico-financieras de las 100 empresas productoras de electricidad mediante generación eólica con mayor volumen de activo.</p>
<p>Es muy importante observar que existen variables con datos faltantes (<em>missing values</em>). En concreto, podemos identificar estas faltas de dato por la existencia de celdas en blanco; pero también por la existencia de celdas con el texto “n.d.” (no dato) o “s.d.” (sin dato). Es muy importante identificar el modo en que quedan recogidos los datos faltantes en la hoja de cálculo, ya que <strong>tendremos que aplicar código adicional</strong> en el comando de importación de R <strong>para que estos casos queden correctamente recogidos como <em>NAs</em></strong> (<em>not available</em>).</p>
<p>Cerraremos el archivo de Microsoft® Excel®, “eolica_100_mv.xlsx” y volveremos a RStudio. Después, abriremos nuestro <em>script</em> “explora_describe.R” con <code>File → Open File…</code> Este <em>script</em> contiene el programa que vamos a ir ejecutando en la práctica.</p>
<p>La primera línea / instrucción en el <em>script</em> es:</p>
<div class="sourceCode" id="cb187"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>La instrucción tiene como objeto limpiar el <em>Environment</em> (memoria) de objetos de anteriores sesiones de trabajo. Para importar los datos que hay en la hoja “Datos” del archivo de Microsoft® Excel® llamado “eolica_100_mv.xlsx”, ejecutaremos el código:</p>
<div class="sourceCode" id="cb188"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://readxl.tidyverse.org">readxl</a></span><span class="op">)</span></span>
<span><span class="va">eolica_100</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html">read_excel</a></span><span class="op">(</span><span class="st">"eolica_100_mv.xlsx"</span>, sheet <span class="op">=</span> <span class="st">"Datos"</span>,</span>
<span>                         na <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"n.d."</span>, <span class="st">"s.d."</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span> <span class="op">(</span><span class="va">eolica_100</span><span class="op">)</span></span></code></pre></div>
<pre><code>##     NOMBRE               RES               ACTIVO             FPIOS        
##  Length:100         Min.   : -5661.5   Min.   :   24944   Min.   : -77533  
##  Class :character   1st Qu.:   669.5   1st Qu.:   34547   1st Qu.:   2305  
##  Mode  :character   Median :  2084.5   Median :   46950   Median :  11936  
##                     Mean   : 11529.9   Mean   :  277270   Mean   : 123743  
##                     3rd Qu.:  3806.7   3rd Qu.:   85610   3rd Qu.:  28292  
##                     Max.   :727548.0   Max.   :13492812   Max.   :6904824  
##                     NA's   :1          NA's   :1                           
## 
##      RENECO           RENFIN            LIQUIDEZ           ENDEUDA       
##  Min.   :-2.813   Min.   :-359.773   Min.   :  0.0140   Min.   :  0.917  
##  1st Qu.: 1.558   1st Qu.:   2.556   1st Qu.:  0.6567   1st Qu.: 50.852  
##  Median : 4.236   Median :  15.326   Median :  1.0650   Median : 83.346  
##  Mean   : 5.416   Mean   :  17.243   Mean   :  2.7214   Mean   : 72.227  
##  3rd Qu.: 7.970   3rd Qu.:  31.307   3rd Qu.:  1.6078   3rd Qu.: 95.388  
##  Max.   :35.262   Max.   : 588.190   Max.   :128.4330   Max.   :140.745  
##  NA's   :2                                              NA's   :2        
## 
##      MARGEN            SOLVENCIA         APALANCA           MATRIZ         
##  Min.   :-2248.157   Min.   :-40.74   Min.   :-8254.11   Length:100        
##  1st Qu.:   12.316   1st Qu.:  4.71   1st Qu.:   16.13   Class :character  
##  Median :   26.618   Median : 16.65   Median :  161.97   Mode  :character  
##  Mean   :    3.228   Mean   : 27.57   Mean   :  345.03                     
##  3rd Qu.:   39.590   3rd Qu.: 45.59   3rd Qu.:  623.13                     
##  Max.   :  400.899   Max.   : 99.08   Max.   :12244.35                     
##  NA's   :2                                                                 
## 
##   DIMENSION        
##  Length:100        
##  Class :character  
##  Mode  :character</code></pre>
<p>Por defecto, R considera las celdas en blanco de la hoja de cálculo como NAs; pero hemos de advertirle del resto de posibilidades que existen en la hoja para comunicar que falta un dato determinado, como ya se ha comentado. Para ello, hemos añadido en la función <code><a href="https://readxl.tidyverse.org/reference/read_excel.html">read_excel()</a></code> el argumento <code>na =</code>, que recoge los contenidos de celda de la hoja de cálculo que indican que falta el dato en cuestión.</p>
<p>Por otro lado, R ha considerado la primera columna como una variable de tipo cualitativo, atributo, o factor. En realidad, esta columna no es una variable, sino que está formada por los nombres de los diferentes casos u observaciones. Para evitar que R tome la columna de los nombres de los casos como una variable más, podemos redefinir nuestro <em>data frame</em> diciéndole que tome esa primera columna como el conjunto de los <em>nombres</em> de los casos:</p>
<div class="sourceCode" id="cb190"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">eolica_100</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">eolica_100</span>, row.names <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span> <span class="op">(</span><span class="va">eolica_100</span><span class="op">)</span></span></code></pre></div>
<pre><code>##       RES               ACTIVO             FPIOS             RENECO      
##  Min.   : -5661.5   Min.   :   24944   Min.   : -77533   Min.   :-2.813  
##  1st Qu.:   669.5   1st Qu.:   34547   1st Qu.:   2305   1st Qu.: 1.558  
##  Median :  2084.5   Median :   46950   Median :  11936   Median : 4.236  
##  Mean   : 11529.9   Mean   :  277270   Mean   : 123743   Mean   : 5.416  
##  3rd Qu.:  3806.7   3rd Qu.:   85610   3rd Qu.:  28292   3rd Qu.: 7.970  
##  Max.   :727548.0   Max.   :13492812   Max.   :6904824   Max.   :35.262  
##  NA's   :1          NA's   :1                            NA's   :2       
## 
##      RENFIN            LIQUIDEZ           ENDEUDA            MARGEN         
##  Min.   :-359.773   Min.   :  0.0140   Min.   :  0.917   Min.   :-2248.157  
##  1st Qu.:   2.556   1st Qu.:  0.6567   1st Qu.: 50.852   1st Qu.:   12.316  
##  Median :  15.326   Median :  1.0650   Median : 83.346   Median :   26.618  
##  Mean   :  17.243   Mean   :  2.7214   Mean   : 72.227   Mean   :    3.228  
##  3rd Qu.:  31.307   3rd Qu.:  1.6078   3rd Qu.: 95.388   3rd Qu.:   39.590  
##  Max.   : 588.190   Max.   :128.4330   Max.   :140.745   Max.   :  400.899  
##                                        NA's   :2         NA's   :2          
## 
##    SOLVENCIA         APALANCA           MATRIZ           DIMENSION        
##  Min.   :-40.74   Min.   :-8254.11   Length:100         Length:100        
##  1st Qu.:  4.71   1st Qu.:   16.13   Class :character   Class :character  
##  Median : 16.65   Median :  161.97   Mode  :character   Mode  :character  
##  Mean   : 27.57   Mean   :  345.03                                        
##  3rd Qu.: 45.59   3rd Qu.:  623.13                                        
##  Max.   : 99.08   Max.   :12244.35</code></pre>
<p>Observaremos que ya no aparece NOMBRE, puesto que la columna correspondiente ya no es considerada como una variable.</p>
</div>
<div id="análisis-de-una-variable." class="section level2" number="5.2">
<h2>
<span class="header-section-number">5.2</span> Análisis de una variable.<a class="anchor" aria-label="anchor" href="#an%C3%A1lisis-de-una-variable."><i class="fas fa-link"></i></a>
</h2>
<div id="buscando-missing-values-y-outliers." class="section level3" number="5.2.1">
<h3>
<span class="header-section-number">5.2.1</span> Buscando <em>missing values</em> y <em>outliers</em>.<a class="anchor" aria-label="anchor" href="#buscando-missing-values-y-outliers."><i class="fas fa-link"></i></a>
</h3>
<p>Vamos a suponer que la variable que queremos estudiar es la variable <em>Rentabilidad Económica</em> (RENECO).</p>
<p>La primera acción que debe realizarse es comprobar que todos los casos (empresas) tienen su correspondiente dato o valor para la variable (RENECO), es decir, que no existen <strong>valores perdidos o <em>missing values</em></strong>.</p>
<p>Para tener una idea general, se puede utilizar la función <code><a href="https://docs.ropensci.org/visdat/reference/vis_miss.html">vis_miss()</a></code> del paquete <a href="https://docs.ropensci.org/visdat/">visdat</a>, que nos localizará gráficamente los <em>missing values</em> de las diferentes variables, y calculará el porcentaje de casos que supone, con respecto al total de observaciones:</p>
<div class="sourceCode" id="cb192"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/visdat/">visdat</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://docs.ropensci.org/visdat/reference/vis_miss.html">vis_miss</a></span><span class="op">(</span><span class="va">eolica_100</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="RstarS_files/figure-html/unnamed-chunk-305-1.png" width="672"></div>
<p>Puede observarse cómo, en el caso concreto de la variable RENECO, un 2% de los casos no tienen dato (es decir, 2 casos de los 100). Para localizar los casos concretos, puede recurrirse a utilizar las herramientas de manejo de <em>data frames</em> del paquete <a href="https://dplyr.tidyverse.org">dplyr</a>. En concreto, realizaremos una copia del <em>data frame</em> original, “eolica_100”, a la que llamaremos “muestra”, que es con la que trabajaremos (para mantener la integridad del <em>data frame</em> original); y filtraremos los casos para detectar aquellos que carecen de valor en la variable RENECO:</p>
<div class="sourceCode" id="cb193"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span> <span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="va">muestra</span><span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">eolica_100</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">muestra</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">RENECO</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">RENECO</span><span class="op">)</span></span></code></pre></div>
<p>La función <code><a href="https://rdrr.io/r/base/NA.html">is.na()</a></code> comprueba si, en la posición correspondiente a una fila o caso, para la variable escrita en el argumento; hay o no un dato o valor. Como resultado se obtienen dos empresas, para las que se puede comprobar que no hay valor para la variable RENECO:</p>
<pre><code>##                       RENECO
## Viesgo Renovables SL.     NA
## Sargon Energias SLU       NA</code></pre>
<p>Ante la existencia de <em>missing values</em>, se puede actuar de varios modos. Por ejemplo, se puede intentar obtener por otro canal de información el conjunto de valores de RENECO que no están disponibles, o recurrir a alguna estimación para los mismos y asignarlos. En caso de que esto sea difícil, se puede optar, simplemente, por eliminar estos casos, en especial cuando representan un porcentaje muy reducido respecto al total de casos. En nuestro ejemplo, vamos a suponer que hemos optado por esta última vía, al no conseguir unos valores más o menos verosímiles de RENECO para las empresas de las que se carece de dato. Esta <strong>eliminación de casos</strong> se podrá realizar mediante el código:</p>
<div class="sourceCode" id="cb195"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">muestra</span> <span class="op">&lt;-</span> <span class="va">muestra</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">RENECO</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>El operador <strong><code>!</code></strong> significa “no”.</p>
<p>Podemos comprobar cómo en el <em>Global Environment</em> aparece el <em>data frame</em> “muestra” con dos casos menos (98):</p>
<div class="float">
<img src="figuras/Imagen4_01.png" width="500" alt="Global Environment."><div class="figcaption">Global Environment.</div>
</div>
<p>Una vez tratados los casos con valores perdidos o <em>missing values</em>, <strong>conviene detectar la posible presencia en la muestra de <em>outliers</em></strong> o casos atípicos, que pudieran desvirtuar los resultados derivados de ciertos análisis. Al trabajar con una sola variable métrica (la rentabilidad económica, RENECO), podemos intentar realizar esta tarea <strong>representando gráficamente</strong> la variable mediante un <strong><em>boxplot</em></strong> o <em>gráfico de caja</em>. Aplicaremos, por ejemplo, el código siguiente, que utiliza la gramática del paquete <a href="https://ggplot2.tidyverse.org">ggplot2</a>:</p>
<div class="sourceCode" id="cb196"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span> <span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">muestra</span>, map <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">RENECO</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"orange"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"RENTABILIDAD ECONÓMICA"</span>, subtitle <span class="op">=</span> <span class="st">"Empresas eólicas"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Rentabilidad Económica (%)"</span><span class="op">)</span></span></code></pre></div>
<p>Obteniéndose el gráfico:</p>
<div class="inline-figure"><img src="RstarS_files/figure-html/unnamed-chunk-310-1.png" width="672"></div>
<p>La “caja” contiene el 50% de los valores de la variable que toman los casos centrales (los que van del primer cuartil al tercero, cuya diferencia se llama <em>rango intercuartílico</em>), y contiene una línea horizontal que es la mediana (segundo cuartil). Por arriba sobresale un segmento que llega al mayor valor de la variable que toma algún caso y que no llega a ser atípico; y por debajo de la caja otro segmento que llega al menor valor de la variable que toma algún caso y que no llega a ser atípico. Los casos atípicos o outliers son aquellos que toman valores que se alejan más de 1.5 veces del rango intercuartílico (altura de la caja) del tercer cuartil, por arriba; o del primer cuartil, por abajo. Se registran mediante puntos.</p>
<p>En nuestro caso, el <em>boxplot</em> ratifica la existencia de dos casos atípicos. Para identificar esos dos casos concretos, podemos recurrir al paquete <a href="https://dplyr.tidyverse.org">dplyr</a>, y <strong>establecer un filtro</strong> con el siguiente código:</p>
<div class="sourceCode" id="cb197"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Q1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span> <span class="op">(</span><span class="va">muestra</span><span class="op">$</span><span class="va">RENECO</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Q3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span> <span class="op">(</span><span class="va">muestra</span><span class="op">$</span><span class="va">RENECO</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.75</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">muestra</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">RENECO</span> <span class="op">&gt;</span> <span class="va">Q3</span> <span class="op">+</span> <span class="fl">1.5</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/IQR.html">IQR</a></span><span class="op">(</span><span class="va">RENECO</span><span class="op">)</span> <span class="op">|</span> <span class="va">RENECO</span> <span class="op">&lt;</span> <span class="va">Q1</span> <span class="op">-</span> <span class="fl">1.5</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/IQR.html">IQR</a></span><span class="op">(</span><span class="va">RENECO</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">RENECO</span><span class="op">)</span></span></code></pre></div>
<p>En el código anterior, las dos primeras filas calculan los cuartiles primero (Q1) y tercero (Q3) mediante la función <code><a href="https://rdrr.io/r/stats/quantile.html">quantile()</a></code>. En esta función, es preciso poner como segundo argumento la proporción de casos que van a quedar por debajo del “cuantil” en cuestión (por ejemplo, el primer cuartil se calcula poniendo 0.25, dado que deja por debajo al 25% de casos con menor valor en la variable). Luego se filtran los <em>outliers</em> mediante la función <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> de <a href="https://dplyr.tidyverse.org">dplyr</a> , calculados como aquellos casos con valores de RENECO mayores que Q3 más 1,5 veces el rango intercuartílico de la variable; o menores que Q1 menos 1,5 veces dicho rango intercuartílico. Para calcular el rango intercuartílico se recurre a la función <code><a href="https://rdrr.io/r/stats/IQR.html">IQR()</a></code>. Finalmente, con <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code>, se muestran los casos en la consola de R-Studio:</p>
<pre><code>##                     RENECO
## Molinos Del Ebro SA 35.262
## Sierra De Selva SL  21.761</code></pre>
<p>Como ocurría con los <em>missing values</em>, el tratamiento de los <em>outliers</em> depende de la información que se tenga, existiendo varias alternativas (corrección del dato, estimación, etc.) Si no se tiene información fiable, y los <em>outliers</em> no representan una gran proporción respecto al total de casos, puede optarse por su eliminación de la muestra. En este ejemplo, efectivamente, <strong>eliminaremos estas dos empresas con comportamiento atípico</strong> en la rentabilidad económica (RENECO), a fin de que su presencia en la muestra <strong>no</strong> <strong>distorsione los resultados en la aplicación posterior de ciertas técnicas</strong> (por ejemplo, un ANOVA o un análisis de regresión). Podemos hacerlo creando un nuevo <em>data frame</em> a partir de “muestra”; pero sin esos dos casos. Ese nuevo <em>data frame</em> se llamará, por ejemplo, “muestra_so”:</p>
<div class="sourceCode" id="cb199"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">muestra_so</span> <span class="op">&lt;-</span> <span class="va">muestra</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>            <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">RENECO</span> <span class="op">&lt;=</span> <span class="va">Q3</span> <span class="op">+</span> <span class="fl">1.5</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/IQR.html">IQR</a></span><span class="op">(</span><span class="va">RENECO</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">RENECO</span> <span class="op">&gt;=</span> <span class="va">Q1</span> <span class="op">-</span> <span class="fl">1.5</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/IQR.html">IQR</a></span><span class="op">(</span><span class="va">RENECO</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Es importante observar que, en el código de la función <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code>, las desigualdades deben cambiar, así como el operador “<strong>|</strong>” por el operador “<strong>&amp;</strong>”. En el <em>Global Environment</em> podemos comprobar cómo el <em>data frame</em> “muestra_so” posee el mismo número de variables que el <em>data frame</em> “muestra”; pero con dos observaciones o casos menos (96).</p>
</div>
<div id="descripción-de-una-variable." class="section level3" number="5.2.2">
<h3>
<span class="header-section-number">5.2.2</span> Descripción de una variable.<a class="anchor" aria-label="anchor" href="#descripci%C3%B3n-de-una-variable."><i class="fas fa-link"></i></a>
</h3>
<p>Una vez que se tiene preparada la base de datos, con un tratamiento adecuado de los <em>missing values</em> y de los <em>outliers,</em> y <strong>antes</strong> de proceder a la aplicación de una técnica adecuada según los objetivos perseguidos en el estudio; suelen presentarse una serie de <strong>gráficos</strong> básicos y <strong>medidas</strong> descriptivas que proporcionan una <strong>idea inicial de la estructura</strong> del sector para la variable o variables analizadas. Nos referimos a medidas y/o gráficos de posición, dispersión y forma (asimetría y curtosis).</p>
<p>Antes de ello, se puede presentar una tabla donde se recoja la distribución de frecuencias de la variable. Si son muchos los casos (en el ejemplo, 96), la distribución podría presentarse agrupada en intervalos, como ya se vio en el capítulo 4 de este libro. De este modo, el código para generar la tabla podría ser:</p>
<div class="sourceCode" id="cb200"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Tabla de datos (distribución de frecuencias agrupadas en intervalos)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span> <span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/">knitr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span> <span class="op">(</span><span class="va"><a href="http://haozhu233.github.io/kableExtra/">kableExtra</a></span><span class="op">)</span></span>
<span><span class="va">muestra_so</span> <span class="op">&lt;-</span> <span class="va">muestra_so</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">RENECO</span>, <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">muestra_so</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Crear los intervalos</span></span>
<span><span class="va">muestra_so</span><span class="op">$</span><span class="va">intervalos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span><span class="op">(</span><span class="va">muestra_so</span><span class="op">$</span><span class="va">RENECO</span>, breaks <span class="op">=</span> <span class="fl">5</span>, include.lowest <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Contar las frecuencias de cada intervalo</span></span>
<span><span class="va">conteo_intervalos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">muestra_so</span><span class="op">$</span><span class="va">intervalos</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Convertir el resultado a un data frame para una mejor visualización</span></span>
<span><span class="va">conteo_intervalos_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">conteo_intervalos</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Renombrar las columnas para mayor claridad</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">conteo_intervalos_df</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Intervalo"</span>, <span class="st">"Frecuencia"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calcular y guardar la frecuencia total</span></span>
<span><span class="va">N_agre</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">conteo_intervalos_df</span><span class="op">$</span><span class="va">Frecuencia</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calcular frecuencias absolutas acumuladas</span></span>
<span><span class="va">conteo_intervalos_df</span><span class="op">$</span><span class="va">Frecuencia_acum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op">(</span><span class="va">conteo_intervalos_df</span><span class="op">$</span><span class="va">Frecuencia</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calcular frecuencias relativas</span></span>
<span><span class="va">conteo_intervalos_df</span><span class="op">$</span><span class="va">Frecuencia_R</span> <span class="op">&lt;-</span> <span class="va">conteo_intervalos_df</span><span class="op">$</span><span class="va">Frecuencia</span> <span class="op">/</span> <span class="va">N_agre</span></span>
<span></span>
<span><span class="co"># Calcular frecuencias relativas acumuladas</span></span>
<span><span class="va">conteo_intervalos_df</span><span class="op">$</span><span class="va">Frecuencia_R_acum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op">(</span><span class="va">conteo_intervalos_df</span><span class="op">$</span><span class="va">Frecuencia_R</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Mostrar el resultado</span></span>
<span><span class="va">conteo_intervalos_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span>caption <span class="op">=</span> <span class="st">"Distribución de frecuencias agrupadas en intervalos de la Rentabilidad Económica"</span>,</span>
<span>        col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Intervalo rentabilidad"</span>, <span class="st">"Frecuencia absoluta n(i)"</span>,</span>
<span>                      <span class="st">"Frecuencia absoluta acum. N(i)"</span>, <span class="st">"Frecuencia relativa f(i)"</span>,</span>
<span>                      <span class="st">"Frecuencia relativa acum. F(i)"</span><span class="op">)</span>,</span>
<span>        format.args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>decimal.mark <span class="op">=</span> <span class="st">"."</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html">kable_styling</a></span><span class="op">(</span>full_width <span class="op">=</span> <span class="cn">F</span>, bootstrap_options <span class="op">=</span> <span class="st">"striped"</span>,</span>
<span>                <span class="st">"bordered"</span>, <span class="st">"condensed"</span>,</span>
<span>                position <span class="op">=</span> <span class="st">"center"</span>, font_size <span class="op">=</span> <span class="fl">11</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/row_spec.html">row_spec</a></span><span class="op">(</span><span class="fl">0</span>, bold<span class="op">=</span> <span class="cn">T</span>, align <span class="op">=</span> <span class="st">"c"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/row_spec.html">row_spec</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">conteo_intervalos_df</span><span class="op">)</span><span class="op">)</span>, bold<span class="op">=</span> <span class="cn">F</span>, align <span class="op">=</span> <span class="st">"c"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-striped" style="font-size: 11px; width: auto !important; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:unnamed-chunk-317">Table 5.1: </span><span id="tab:unnamed-chunk-317">Table 5.2: </span>Distribución de frecuencias agrupadas en intervalos de la Rentabilidad Económica
</caption>
<thead><tr>
<th style="text-align:left;font-weight: bold;text-align: center;">
Intervalo rentabilidad
</th>
<th style="text-align:right;font-weight: bold;text-align: center;">
Frecuencia absoluta n(i)
</th>
<th style="text-align:right;font-weight: bold;text-align: center;">
Frecuencia absoluta acum. N(i)
</th>
<th style="text-align:right;font-weight: bold;text-align: center;">
Frecuencia relativa f(i)
</th>
<th style="text-align:right;font-weight: bold;text-align: center;">
Frecuencia relativa acum. F(i)
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;text-align: center;">
[-2.83,0.926]
</td>
<td style="text-align:right;text-align: center;">
16
</td>
<td style="text-align:right;text-align: center;">
16
</td>
<td style="text-align:right;text-align: center;">
0.17
</td>
<td style="text-align:right;text-align: center;">
0.17
</td>
</tr>
<tr>
<td style="text-align:left;text-align: center;">
(0.926,4.66]
</td>
<td style="text-align:right;text-align: center;">
38
</td>
<td style="text-align:right;text-align: center;">
54
</td>
<td style="text-align:right;text-align: center;">
0.40
</td>
<td style="text-align:right;text-align: center;">
0.56
</td>
</tr>
<tr>
<td style="text-align:left;text-align: center;">
(4.66,8.4]
</td>
<td style="text-align:right;text-align: center;">
21
</td>
<td style="text-align:right;text-align: center;">
75
</td>
<td style="text-align:right;text-align: center;">
0.22
</td>
<td style="text-align:right;text-align: center;">
0.78
</td>
</tr>
<tr>
<td style="text-align:left;text-align: center;">
(8.4,12.1]
</td>
<td style="text-align:right;text-align: center;">
11
</td>
<td style="text-align:right;text-align: center;">
86
</td>
<td style="text-align:right;text-align: center;">
0.11
</td>
<td style="text-align:right;text-align: center;">
0.90
</td>
</tr>
<tr>
<td style="text-align:left;text-align: center;">
(12.1,15.9]
</td>
<td style="text-align:right;text-align: center;">
10
</td>
<td style="text-align:right;text-align: center;">
96
</td>
<td style="text-align:right;text-align: center;">
0.10
</td>
<td style="text-align:right;text-align: center;">
1.00
</td>
</tr>
</tbody>
</table></div>
<p>El <strong>análisis gráfico</strong> suele dar una idea atractiva e intuitiva de la estructura de la distribución de frecuencias de nuestro conjunto de casos en relación con la variable a analizar. Un gráfico fundamental es el <strong>histograma</strong> de la variable estudiada. Para ello, utilizaremos la gramática del paquete <a href="https://ggplot2.tidyverse.org">ggplot2</a>:</p>
<div class="sourceCode" id="cb201"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Descriptivos básicos</span></span>
<span></span>
<span><span class="co"># Gráficos básicos</span></span>
<span></span>
<span><span class="va">g1</span> <span class="op">&lt;-</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">muestra_so</span>, map <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">RENECO</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">40</span>,</span>
<span>                 colour <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>                 fill <span class="op">=</span> <span class="st">"orange"</span>,</span>
<span>                 alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">muestra_so</span><span class="op">$</span><span class="va">RENECO</span><span class="op">)</span>,</span>
<span>             color <span class="op">=</span> <span class="st">"dark blue"</span>,</span>
<span>             size <span class="op">=</span> <span class="fl">1.2</span>,</span>
<span>             alpha <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Histograma"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Rentabilidad Económica (%)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Frecuencias"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">g1</span></span></code></pre></div>
<div class="inline-figure"><img src="RstarS_files/figure-html/unnamed-chunk-318-1.png" width="672"></div>
<p>En el gráfico vemos de un modo bastante nítido la distribución de frecuencias en cuanto a la rentabilidad económica (RENECO). Se ha incorporado una línea vertical azul (mediante <code><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline()</a></code>) para localizar la rentabilidad media. Entre otras cosas, se puede apreciar que la distribución de frecuencias es acampanada y <em>asimétrica positiva</em>.</p>
<p>Como complemento al histograma, podemos realizar un gráfico de densidad de RENECO, al que añadiremos una curva normal con la misma media y desviación típica que nuestra distribución de frecuencias, y que se añade mediante <code><a href="https://ggplot2.tidyverse.org/reference/geom_function.html">stat_function()</a></code> y el argumento <code>fun = dnorm</code>. Este gráfico representa la distribución de probabilidad empírica de la muestra, es una especie de histograma “suavizado”. De este modo, se podrán verificar de un modo fácil algunas de las características avanzadas con la observación del histograma, como la asimetría positiva. El código es:</p>
<div class="sourceCode" id="cb202"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">g2</span> <span class="op">&lt;-</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">muestra_so</span>, map <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">RENECO</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>               fill <span class="op">=</span> <span class="st">"orange"</span>,</span>
<span>               alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">muestra_so</span><span class="op">$</span><span class="va">RENECO</span><span class="op">)</span>,</span>
<span>             color <span class="op">=</span> <span class="st">"dark blue"</span>,</span>
<span>             size <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>             alpha <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_function.html">stat_function</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="va">dnorm</span>, args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">muestra_so</span><span class="op">$</span><span class="va">RENECO</span><span class="op">)</span>,</span>
<span>                                         sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">muestra_so</span><span class="op">$</span><span class="va">RENECO</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                         geom <span class="op">=</span> <span class="st">"area"</span>, color <span class="op">=</span> <span class="st">"darkblue"</span>, </span>
<span>                                         fill <span class="op">=</span> <span class="st">"yellow"</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Gráfico de densidad vs curva normal"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Rentabilidad Económica (%)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Densidad"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">g2</span></span></code></pre></div>
<div class="inline-figure"><img src="RstarS_files/figure-html/unnamed-chunk-319-1.png" width="672"></div>
<p>Un tercer gráfico útil es el box-plot una vez se eliminaron los casos outliers, con la incorporación de los valores que toman los casos que componen la muestra, para lo cuál se utiliza el <code>geom_jitter</code>:</p>
<div class="sourceCode" id="cb203"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">g3</span> <span class="op">&lt;-</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">muestra_so</span>, map <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="va">RENECO</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>               fill <span class="op">=</span> <span class="st">"orange"</span>,</span>
<span>               outlier.shape <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html">stat_summary</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>               geom <span class="op">=</span> <span class="st">"point"</span>,</span>
<span>               size <span class="op">=</span> <span class="fl">3</span>,</span>
<span>               col <span class="op">=</span> <span class="st">"darkblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>              size <span class="op">=</span> <span class="fl">1</span>,</span>
<span>              col <span class="op">=</span> <span class="st">"darkred"</span>,</span>
<span>              alpha <span class="op">=</span> <span class="fl">0.50</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Box-Plot"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Rentabilidad Económica (%)"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">g3</span></span></code></pre></div>
<div class="inline-figure"><img src="RstarS_files/figure-html/unnamed-chunk-320-1.png" width="672"></div>
<p>Por otro lado, conviene tener conocimiento del valor de las principales <strong>medidas descriptivas</strong> (de posición, dispersión, forma) que caracterizan a la distribución de la variable a analizar. Para ello, vamos a crear un <em>data frame</em> llamado, por ejemplo, “estadisticos”, que recogerá las diferentes medidas, calculadas al aplicar a la variable RENECO del <em>data frame</em> “muestra_so” la función de <code>{deplyr}</code> llamada <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code>. Se calcularán la media, desviación típica, valor mínimo, mediana, valor máximo, el coeficiente de asimetría de Fisher, y el coeficiente de apuntamiento o curtosis de Fisher. Precisamente, para poder calcular esta última medida, es preciso activar el paquete <a href="https://www.r-project.org">moments</a>, que contiene la función <code><a href="https://rdrr.io/pkg/moments/man/kurtosis.html">kurtosis()</a></code>. La versión del coeficiente de apuntamiento de esta función dispone como distribución perfectamente mesocúrtica el valor de 3, por lo que se le restará 3 en la versión que manejaremos para que la distribución mesocúrtica se sitúe en un coeficiente de 0. El código es:</p>
<div class="sourceCode" id="cb204"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calcular estadísticos</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span> <span class="op">(</span><span class="va"><a href="https://www.r-project.org">moments</a></span><span class="op">)</span> <span class="co"># paquete necesario para calcular la curtosis.</span></span>
<span></span>
<span><span class="va">estadisticos</span> <span class="op">&lt;-</span> <span class="va">muestra_so</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span> Media <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">RENECO</span><span class="op">)</span>,</span>
<span>                                          DT <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">RENECO</span><span class="op">)</span>,</span>
<span>                                          Mínimo <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">RENECO</span><span class="op">)</span>,</span>
<span>                                          Mediana <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">RENECO</span><span class="op">)</span>,</span>
<span>                                          Maximo <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">RENECO</span><span class="op">)</span>,</span>
<span>                                          Asimetria <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/moments/man/skewness.html">skewness</a></span><span class="op">(</span><span class="va">RENECO</span><span class="op">)</span>,</span>
<span>                                          Curtosis <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/moments/man/kurtosis.html">kurtosis</a></span><span class="op">(</span><span class="va">RENECO</span><span class="op">)</span> <span class="op">-</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p>La ventaja de volcar las medidas y estadísticos en el data frame (de un solo caso) “estadisticos” es que se pueden mostrar los valores en una tabla elegante generada a partir de el mismo mediante las funciones knitr() y kableExtra(), como ya sabemos:</p>
<div class="sourceCode" id="cb205"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Mostrar estadisticos</span></span>
<span></span>
<span><span class="va">estadisticos</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span>caption <span class="op">=</span> <span class="st">"Principales Estadísticos de la Rentabilidad Económica"</span>,</span>
<span>        col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Media"</span>, <span class="st">"Mediana"</span>,</span>
<span>                      <span class="st">"Desviación Típica"</span>, <span class="st">"Valor mínimo"</span>,</span>
<span>                      <span class="st">"Valor Máximo"</span>, <span class="st">"C. Asimetría Fisher"</span>,</span>
<span>                      <span class="st">"C. Curtosis Fisher"</span><span class="op">)</span>,</span>
<span>        format.args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>decimal.mark <span class="op">=</span> <span class="st">"."</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html">kable_styling</a></span><span class="op">(</span>full_width <span class="op">=</span> <span class="cn">F</span>, bootstrap_options <span class="op">=</span> <span class="st">"striped"</span>,</span>
<span>                <span class="st">"bordered"</span>, <span class="st">"condensed"</span>,</span>
<span>                position <span class="op">=</span> <span class="st">"center"</span>, font_size <span class="op">=</span> <span class="fl">11</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/row_spec.html">row_spec</a></span><span class="op">(</span><span class="fl">0</span>, bold<span class="op">=</span> <span class="cn">T</span>, align <span class="op">=</span> <span class="st">"c"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/row_spec.html">row_spec</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">estadisticos</span><span class="op">)</span><span class="op">)</span>, bold<span class="op">=</span> <span class="cn">F</span>, align <span class="op">=</span> <span class="st">"c"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-striped" style="font-size: 11px; width: auto !important; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:unnamed-chunk-323">Table 5.3: </span><span id="tab:unnamed-chunk-323">Table 5.4: </span>Principales Estadísticos de la Rentabilidad Económica
</caption>
<thead><tr>
<th style="text-align:right;font-weight: bold;text-align: center;">
Media
</th>
<th style="text-align:right;font-weight: bold;text-align: center;">
Mediana
</th>
<th style="text-align:right;font-weight: bold;text-align: center;">
Desviación Típica
</th>
<th style="text-align:right;font-weight: bold;text-align: center;">
Valor mínimo
</th>
<th style="text-align:right;font-weight: bold;text-align: center;">
Valor Máximo
</th>
<th style="text-align:right;font-weight: bold;text-align: center;">
C. Asimetría Fisher
</th>
<th style="text-align:right;font-weight: bold;text-align: center;">
C. Curtosis Fisher
</th>
</tr></thead>
<tbody><tr>
<td style="text-align:right;text-align: center;">
4.9
</td>
<td style="text-align:right;text-align: center;">
4.3
</td>
<td style="text-align:right;text-align: center;">
-2.8
</td>
<td style="text-align:right;text-align: center;">
4.1
</td>
<td style="text-align:right;text-align: center;">
16
</td>
<td style="text-align:right;text-align: center;">
0.56
</td>
<td style="text-align:right;text-align: center;">
-0.37
</td>
</tr></tbody>
</table></div>
<p>La interpretación de estas medidas fueron comentadas en el capítulo 4.</p>
</div>
<div id="normalidad." class="section level3" number="5.2.3">
<h3>
<span class="header-section-number">5.2.3</span> Normalidad.<a class="anchor" aria-label="anchor" href="#normalidad."><i class="fas fa-link"></i></a>
</h3>
<p>En muchas técnicas multivariantes basadas en métodos inferenciales (por ejemplo, análisis de la varianza, o en la regresión lineal), se requiere que las variables sigan una <strong>distribución normal</strong>. Para comprobarlo, se puede a recurrir a análisis gráficos o a análisis formales, estos últimos basados en contrastar la hipótesis nula de normalidad.</p>
<p>Vamos a mostrar un <strong>método gráfico</strong> muy extendido. Comprobaremos la normalidad de la variable RENECO mediante un <strong><em>gráfico qq</em></strong> (cuantil-cuantil), que compara los cuantiles de nuestra muestra con los de una distribución normal teórica (con la misma media y desviación típica). Si los puntos se sitúan cercanos a la diagonal, entonces se asumirá un comportamiento (aproximadamente) normal. El código para realizar el gráfico con las herramientas del paquete <a href="https://ggplot2.tidyverse.org">ggplot2</a> es:</p>
<div class="sourceCode" id="cb206"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Normalidad</span></span>
<span></span>
<span><span class="co"># Grafico QQ</span></span>
<span></span>
<span><span class="va">g4</span> <span class="op">&lt;-</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">muestra_so</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>sample <span class="op">=</span> <span class="va">RENECO</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_qq.html">stat_qq</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_qq.html">stat_qq_line</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"dark blue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"QQ-Plot"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">g4</span></span></code></pre></div>
<p>Y el resultado:</p>
<div class="inline-figure"><img src="RstarS_files/figure-html/unnamed-chunk-325-1.png" width="672"></div>
<p>A veces, es difícil obtener una conclusión sólida con el gráfico <em>qq</em>; aunque en el ejemplo se aprecia, sobre todo en los primeros puntos, una separación notable de estos con respecto a la línea, lo que induce a pensar en que podría <strong>no</strong> seguirse una distribución normal.</p>
<p>Si queremos ser más precisos, en lugar de un análisis gráfico se puede recurrir a realizar un análisis formal, basado en la realización de <strong>contrastes de hipótesis</strong>. Una prueba muy usual es la <strong>prueba de normalidad de <em>Shapiro y Wilk</em></strong>, que tiene un buen comportamiento en muestras relativamente reducidas. En esta prueba, la hipótesis nula equivale al supuesto de normalidad. Para un 5% de significación estadística, un p-valor superior a 0.05 implicará el no-rechazo de la hipótesis de normalidad. Para realizar la prueba, se ejecutará el código:</p>
<div class="sourceCode" id="cb207"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Prueba de Shapiro-Wilk</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/shapiro.test.html">shapiro.test</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">muestra_so</span><span class="op">$</span><span class="va">RENECO</span><span class="op">)</span></span></code></pre></div>
<p>El resultado obtenido en la consola:</p>
<pre><code>## 
##  Shapiro-Wilk normality test
## 
## data:  muestra_so$RENECO
## W = 0.9605, p-value = 0.005523</code></pre>
<p>Como el p-valor es (muy) inferior a 0.05, <strong>se rechaza la hipótesis nula de normalidad en la distribución</strong>, lo que implica que, para una significación estadística del 5%, admitimos que RENECO <strong>no</strong> sigue, para nuestra muestra, un comportamiento normal, como ya se anticipó con el gráfico <em>qq</em>.</p>
</div>
<div id="resumen-los-4-gráficos-básicos-en-la-descripción-de-una-variable." class="section level3" number="5.2.4">
<h3>
<span class="header-section-number">5.2.4</span> Resumen: los 4 gráficos básicos en la descripción de una variable.<a class="anchor" aria-label="anchor" href="#resumen-los-4-gr%C3%A1ficos-b%C3%A1sicos-en-la-descripci%C3%B3n-de-una-variable."><i class="fas fa-link"></i></a>
</h3>
<p>En definitiva, para describir de un modo inicial una distribución de frecuencias de una variable (en escala métrica), podrían analizarse los 4 gráficos que se han comentado anteriormente. Estos gráficos se pueden presentar conjuntamente, para ahorrar espacio en un informe, utilizando el paquete <a href="https://patchwork.data-imaginist.com">patchwork</a>, que permite combinar e integrar en una sola imagen varios gráficos generados con <a href="https://ggplot2.tidyverse.org">ggplot2</a>. En nuestro ejemplo, vamos a generar una figura que integra los 4 gráficos anteriores (que hemos denominado “g1”, “g2”, “g3” y “g4”). Para ello creamos el objeto “resumen”, que integra los gráficos, mediante una asignación con la sintaxis del paquete <a href="https://patchwork.data-imaginist.com">patchwork</a>: El operador <code>/</code> indica que los gráficos siguientes se dispondrán inmediatamente debajo; mientras que <code>|</code> indica que el gráfico siguiente se dispone al lado del anterior. Luego, se le añade también un título y un subtítulo:</p>
<div class="sourceCode" id="cb209"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Resumen gráfico</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span> <span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com">patchwork</a></span><span class="op">)</span></span>
<span><span class="va">resumen</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">g1</span> <span class="op">|</span> <span class="va">g2</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="va">g3</span> <span class="op">|</span> <span class="va">g4</span><span class="op">)</span></span>
<span><span class="va">resumen</span> <span class="op">&lt;-</span> <span class="va">resumen</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_annotation.html">plot_annotation</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Rentabilidad Económica"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Empresas eólicas (sin outliers)"</span><span class="op">)</span></span>
<span><span class="va">resumen</span></span></code></pre></div>
<div class="inline-figure"><img src="RstarS_files/figure-html/unnamed-chunk-328-1.png" width="672"></div>
</div>
</div>
<div id="análisis-de-múltiples-variables." class="section level2" number="5.3">
<h2>
<span class="header-section-number">5.3</span> Análisis de múltiples variables.<a class="anchor" aria-label="anchor" href="#an%C3%A1lisis-de-m%C3%BAltiples-variables."><i class="fas fa-link"></i></a>
</h2>
<p>Son muchas las técnicas aplicadas al análisis de datos económicos basadas en una distribución de frecuencias multivariante. En este apartado nos centraremos en el caso de <strong>variables métricas</strong>, ya que al caso de atributos, variables categóricas o factores; le dedicaremos un capítulo en exclusiva. Algunas técnicas multivariantes son el análisis de componentes principales, el análisis de regresión, el análisis clúster…</p>
<p>Todas estas metodologías requieren, de nuevo, de una fase inicial que ponga a punto la base de datos y ofrezca una fotografía de cómo es la situación en cuanto a las variables en estudio. En este sentido, es conveniente aplicar, para cada variable por separado, algunos de los análisis gráficos básicos vistos anteriormente.</p>
<p>A estos análisis básicos hay que añadir, principalmente, algún análisis previo adicional, destinado fundamentalmente a comprobar el <strong>grado de intensidad en la relación estadística</strong> entre las variables implicadas. Antes de abordar esta cuestión, hemos de pararnos en una casuística específica que se presenta cuando trabajamos con numerosas variables: la detección de casos atípicos o <em>outliers</em>.</p>
<div id="localización-de-missing-values-y-outliers." class="section level3" number="5.3.1">
<h3>
<span class="header-section-number">5.3.1</span> Localización de <em>missing values</em> y <em>outliers</em>.<a class="anchor" aria-label="anchor" href="#localizaci%C3%B3n-de-missing-values-y-outliers."><i class="fas fa-link"></i></a>
</h3>
<p>Para trabajar con múltiples variables, en primer lugar es preciso localizar los casos con <strong>valores perdidos o <em>missing values</em></strong>, para decidir cómo procesarlos (eliminación del caso, estimación del valor faltante, etc.)</p>
<p>Vamos a imaginar que queremos realizar un análisis en el que tendremos en cuenta las variables RENECO (rentabilidad económica), ACTIVO (volumen de activos de la empresa), MARGEN (margen de beneficio) y RES (resultado del ejercicio).</p>
<p>Ya vimos cómo el siguiente código nos aporta gráficamente una idea de la posible existencia de valores faltantes:</p>
<div class="sourceCode" id="cb210"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Trabajando con multiples variables.</span></span>
<span></span>
<span><span class="co"># Localizando y descartando casos con missing values.</span></span>
<span></span>
<span><span class="fu"><a href="https://docs.ropensci.org/visdat/reference/vis_miss.html">vis_miss</a></span><span class="op">(</span><span class="va">eolica_100</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="RstarS_files/figure-html/unnamed-chunk-329-1.png" width="672"></div>
<p>Podemos apreciar cómo existen varios casos con <em>missing values</em> en las variables objeto de estudio.</p>
<p>Para localizar los <em>missing values</em>, podemos recurrir al siguiente código. En él, hacemos una copia del <em>data frame</em> original, “eolica_100”, para preservar su integridad. A esa copia la hemos llamado “muestra2”. Luego, hemos sometido a “muestra2” a un <em>filtro</em> para detectar los casos en los que no hay valor para alguna (o varias) de las variables analizadas. El operador <strong><code>|</code></strong> significa “o”. Posteriormente, hemos decidido eliminar esos casos. Para ello asignamos a “muestra2” el resultado de pasar un filtro en el que se eligen los casos que no tienen valores faltantes en ninguna de las variables. El operador <strong><code>&amp;</code></strong> significa “y”:</p>
<div class="sourceCode" id="cb211"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Trabajando con multiples variables.</span></span>
<span></span>
<span><span class="co"># Localizando y descartando casos con missing values.</span></span>
<span><span class="va">muestra2</span><span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">eolica_100</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">muestra2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">RENECO</span><span class="op">)</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">ACTIVO</span><span class="op">)</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">MARGEN</span><span class="op">)</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">RES</span><span class="op">)</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>             <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">RENECO</span>, <span class="va">ACTIVO</span>, <span class="va">MARGEN</span>, <span class="va">RES</span><span class="op">)</span></span></code></pre></div>
<pre><code>##                              RENECO    ACTIVO   MARGEN       RES
## Viesgo Renovables SL.            NA 269730.00   11.818  4609.000
## Biovent Energia SA            4.551 183899.00   22.792        NA
## Sargon Energias SLU              NA  85745.00 -615.625 -2216.000
## Parc Eolic Sant Antoni SL     1.361  69654.00       NA   668.000
## Eolica La Brujula SA          7.295  42146.98       NA  2306.062
## La Caldera Energia Burgos SL  2.643        NA   14.448   511.304</code></pre>
<div class="sourceCode" id="cb213"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">muestra2</span> <span class="op">&lt;-</span> <span class="va">muestra2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>            <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">RENECO</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">!</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">ACTIVO</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">!</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">MARGEN</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">!</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">RES</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>El <em>data frame</em> “muestra2” contiene los mismos datos que “eolica_100”, salvo los 6 casos con <em>missing values</em> (94).</p>
<p>Para la <strong>detección de <em>outliers</em></strong>, si las variables que entran en el análisis son numerosas, podría ser poco operativo estudiar las variables una a una. Una alternativa consiste en calcular la <strong><em>distancia de Mahalanobis</em></strong> de las variables del estudio, como <strong>“resumen” del comportamiento de cada caso</strong> en todas las variables del análisis, consideradas conjuntamente.</p>
<p>Así, primero vamos a calcular una columna más en el <em>data frame</em> “muestra2” con los valores de la <em>distancia de</em> <em>Mahalanobis</em> del conjunto de las 4 variables en cada uno de los casos (empresas eólicas). Esta columna o variable la denominaremos, por ejemplo, MAHALANOBIS<em>.</em> Para ello, se utiliza la función <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> del paquete <code>{deplyr}</code>, y como argumento de esta la función <code><a href="https://rdrr.io/r/stats/mahalanobis.html">mahalanobis()</a></code>, en la que hay que especificar:</p>
<ul>
<li><p>Las columnas de “muestra2” para las que se van a calcular las distancias, unidas en una matriz interna con la función <code><a href="https://rdrr.io/r/base/cbind.html">cbind()</a></code>.</p></li>
<li><p>El vector de medias de las variables para las que se calcula la distancia (argumento <code>center =</code>). Las variables, aquí, se recogen con la función <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> de <code>{deplyr}</code>, en donde el punto significa que las columnas pertenecen al <em>data frame</em> al que se llamó con el operador <em>pipe</em> <code>%&gt;%</code>:</p></li>
<li><p>La matriz de varianzas y covarianzas de las variables para las que se calcula la distancia (argumento <code>cov =</code>).</p></li>
</ul>
<p>En definitiva, el código es:</p>
<div class="sourceCode" id="cb214"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Identificando y descartando outliers con distancia de Mahalanobis.</span></span>
<span></span>
<span><span class="va">muestra2</span> <span class="op">&lt;-</span> <span class="va">muestra2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>            <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span> <span class="op">(</span>MAHALANOBIS <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/mahalanobis.html">mahalanobis</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">RENECO</span>, <span class="va">ACTIVO</span>, <span class="va">MARGEN</span>, <span class="va">RES</span><span class="op">)</span>,</span>
<span>                      center <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colMeans</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">RENECO</span>, <span class="va">ACTIVO</span>, <span class="va">MARGEN</span>, <span class="va">RES</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                      cov <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cov</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">RENECO</span>, <span class="va">ACTIVO</span>, <span class="va">MARGEN</span>, <span class="va">RES</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Posteriormente, se puede construir el diagrama de caja de la variable MAHALANOBIS, como cualquier otra variable:</p>
<div class="sourceCode" id="cb215"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">muestra2</span>, map <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">MAHALANOBIS</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"orange"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"DISTANCIA DE MAHALANOBIS"</span>,</span>
<span>            subtitle <span class="op">=</span> <span class="st">"RENECO, ACTIVO, MARGEN, RES. Empresas eólicas "</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"MAHALANOBIS"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="RstarS_files/figure-html/unnamed-chunk-332-1.png" width="672"></div>
<p>Se observa cómo existen varios casos <em>outliers</em>. Para saber de qué casos concretos se trata, se podrá ejecutar el código:</p>
<div class="sourceCode" id="cb216"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Q1M</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span> <span class="op">(</span><span class="va">muestra2</span><span class="op">$</span><span class="va">MAHALANOBIS</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Q3M</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span> <span class="op">(</span><span class="va">muestra2</span><span class="op">$</span><span class="va">MAHALANOBIS</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.75</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">muestra2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">MAHALANOBIS</span> <span class="op">&gt;</span> <span class="va">Q3M</span> <span class="op">+</span> <span class="fl">1.5</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/IQR.html">IQR</a></span><span class="op">(</span><span class="va">MAHALANOBIS</span><span class="op">)</span> <span class="op">|</span></span>
<span>         <span class="va">MAHALANOBIS</span> <span class="op">&lt;</span> <span class="va">Q1M</span> <span class="op">-</span> <span class="fl">1.5</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/IQR.html">IQR</a></span><span class="op">(</span><span class="va">MAHALANOBIS</span><span class="op">)</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">MAHALANOBIS</span>, <span class="va">RENECO</span>, <span class="va">ACTIVO</span>, <span class="va">MARGEN</span>, <span class="va">RES</span><span class="op">)</span> </span></code></pre></div>
<p>En la consola se obtendrá el listado:</p>
<pre><code>##                                MAHALANOBIS RENECO      ACTIVO
## Holding De Negocios De GAS SL.   91.041690  5.264 13492812.00
## Global Power Generation SA.      37.255573  1.393  2002458.00
## Naturgy Renovables SLU           31.675561  1.959  1956869.00
## Saeta Yield SA.                  11.891027  0.360   796886.38
## Molinos Del Ebro SA              29.589696 35.262    62114.37
## Tarraco Eolica SA                 3.600426 12.868    38102.00
## WPD Parque Eolico Navillas SL.   84.589929 -0.416    35511.45
## Brulles Eolica SL                 3.599069 15.882    29722.58
## Sierra De Selva SL                9.055155 21.761    27728.00
## 
##                                   MARGEN         RES
## Holding De Negocios De GAS SL.    91.152 727548.0000
## Global Power Generation SA.       22.403  39995.0000
## Naturgy Renovables SLU            20.442  42737.0000
## Saeta Yield SA.                   16.258   2084.4760
## Molinos Del Ebro SA               41.821  17026.2569
## Tarraco Eolica SA                400.899   4953.0000
## WPD Parque Eolico Navillas SL. -2248.157   -110.9293
## Brulles Eolica SL                 47.227   3540.5693
## Sierra De Selva SL                47.045   4525.0000</code></pre>
<p>Si se opta por eliminar estos casos cara al análisis a aplicar posteriormente, se podrá crear un nuevo <em>data frame</em>, por ejemplo “muestra2_so”, con el código siguiente:</p>
<div class="sourceCode" id="cb218"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">muestra2_so</span> <span class="op">&lt;-</span> <span class="va">muestra2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">MAHALANOBIS</span> <span class="op">&lt;=</span> <span class="va">Q3M</span> <span class="op">+</span> <span class="fl">1.5</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/IQR.html">IQR</a></span><span class="op">(</span><span class="va">MAHALANOBIS</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>           <span class="va">MAHALANOBIS</span> <span class="op">&gt;=</span> <span class="va">Q1M</span> <span class="op">-</span> <span class="fl">1.5</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/IQR.html">IQR</a></span><span class="op">(</span><span class="va">MAHALANOBIS</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<p>El <em>data frame</em> “muestra2_so” será una réplica de “muestra2”, aunque sin incluir los casos detectados como atípicos o <em>outliers</em> (85 casos).</p>
</div>
<div id="correlación-entre-variables." class="section level3" number="5.3.2">
<h3>
<span class="header-section-number">5.3.2</span> Correlación entre variables.<a class="anchor" aria-label="anchor" href="#correlaci%C3%B3n-entre-variables."><i class="fas fa-link"></i></a>
</h3>
<p>Cuando trabajamos con más de una variable, una característica muy importante viene dada por la intensidad con la que tales variables están relacionadas estadísticamente entre sí, es decir, el estudio de las correlaciones. Un modo atractivo y rápido de visualizar la <strong>matriz de correlaciones</strong> de las variables es a través de la función <code><a href="https://ggobi.github.io/ggally/reference/ggpairs.html">ggpairs()</a></code> del paquete <a href="https://ggobi.github.io/ggally/">GGally</a>. Para aplicar la función, hemos creado el <em>data frame</em> “temporal” con las variables (métricas) del estudio, que borramos tras general el gráfico:</p>
<div class="sourceCode" id="cb219"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Correlaciones entre variables.</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span> <span class="op">(</span><span class="va"><a href="https://ggobi.github.io/ggally/">GGally</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">temporal</span> <span class="op">&lt;-</span> <span class="va">muestra2_so</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">RENECO</span>, <span class="va">ACTIVO</span>, <span class="va">MARGEN</span>, <span class="va">RES</span><span class="op">)</span></span>
<span><span class="va">corr_plot_so</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggobi.github.io/ggally/reference/ggpairs.html">ggpairs</a></span><span class="op">(</span><span class="va">temporal</span>, </span>
<span>                        lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>continuous <span class="op">=</span> <span class="fu"><a href="https://ggobi.github.io/ggally/reference/wrap.html">wrap</a></span><span class="op">(</span><span class="st">"cor"</span>,</span>
<span>                        size <span class="op">=</span> <span class="fl">4.5</span>,</span>
<span>                        method <span class="op">=</span> <span class="st">"pearson"</span>,</span>
<span>                        stars <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                        title <span class="op">=</span> <span class="st">"Matriz de Correlación sin outliers"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span><span class="va">temporal</span><span class="op">)</span></span>
<span><span class="va">corr_plot_so</span></span></code></pre></div>
<div class="inline-figure"><img src="RstarS_files/figure-html/unnamed-chunk-336-1.png" width="672"></div>
<p>Un coeficiente de correlación puede tomar un valor entre -1 (fuerte relación, en sentido opuesto) a +1 (fuerte relación, en el mismo sentido). Como puede apreciarse en el gráfico, las variables ACTIVO y RES mantienen una relación muy intensa y en sentido positivo. Entre MARGEN y RENECO existe también una relación de intensidad destacable. En cambio, ACTIVO y MARGEN; y RENECO y ACTIVO apenas están estadísticamente relacionadas.</p>
<p>Antes de terminar la práctica, vamos a comparar las correlaciones anteriores con las que se dan si se incluyen los casos outliers en la muestra. Estas correlaciones se generarán con el mismo código; pero sustituyendo el <em>data frame</em> “muestra2_so” por “muestra”:</p>
<div class="sourceCode" id="cb220"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">temporal</span> <span class="op">&lt;-</span> <span class="va">muestra2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">RENECO</span>, <span class="va">ACTIVO</span>, <span class="va">MARGEN</span>, <span class="va">RES</span><span class="op">)</span></span>
<span><span class="va">corr_plot_co</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggobi.github.io/ggally/reference/ggpairs.html">ggpairs</a></span><span class="op">(</span><span class="va">temporal</span>, </span>
<span>                        lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>continuous <span class="op">=</span> <span class="fu"><a href="https://ggobi.github.io/ggally/reference/wrap.html">wrap</a></span><span class="op">(</span><span class="st">"cor"</span>,</span>
<span>                                                       size <span class="op">=</span> <span class="fl">4.5</span>,</span>
<span>                                                       method <span class="op">=</span> <span class="st">"pearson"</span>,</span>
<span>                                                       stars <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                        title <span class="op">=</span> <span class="st">"Matriz de Correlación con outliers"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span><span class="va">temporal</span><span class="op">)</span></span>
<span><span class="va">corr_plot_co</span></span></code></pre></div>
<div class="inline-figure"><img src="RstarS_files/figure-html/unnamed-chunk-337-1.png" width="672"></div>
<p>Puede observarse cómo la presencia de outliers puede variar la relación entre las variables. Salvo el caso de la correlación entre ACTIVO y RES, que se fortalece; las correlaciones entre RENECO y MARGEN, y RENECO y RES se debilitan (en este último caso, pasa a no ser significativa ni tan siquiera para una significación de 0.1).</p>
<p>Un modo visual para poder comparar ambas figuras consiste en utilizar la función <code><a href="https://ggobi.github.io/ggally/reference/ggmatrix_gtable.html">ggmatrix_gtable()</a></code> del paquete <a href="https://ggobi.github.io/ggally/">GGally</a> para realizar “copias” en formato compatible con la función <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> del paquete <code>{ggplo2}</code>. Estas “copias” pueden integrarse en una sola figura utilizando la función <code><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange()</a></code> del paquete <code>{gridExtra}</code>. Nota: este paquete funciona de modo parecido a <a href="https://patchwork.data-imaginist.com">patchwork</a>, y lo utilizamos porque este último paquete no funciona correctamente al intentar combinar las copias creadas en formato compatible con la función <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code>. El código y resultado serán:</p>
<div class="sourceCode" id="cb221"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">corr_plot_so_gg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggobi.github.io/ggally/reference/ggmatrix_gtable.html">ggmatrix_gtable</a></span><span class="op">(</span><span class="va">corr_plot_so</span><span class="op">)</span></span>
<span><span class="va">corr_plot_co_gg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggobi.github.io/ggally/reference/ggmatrix_gtable.html">ggmatrix_gtable</a></span><span class="op">(</span><span class="va">corr_plot_co</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span> <span class="op">(</span><span class="va">gridExtra</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span><span class="op">(</span><span class="va">corr_plot_so_gg</span>, <span class="va">corr_plot_co_gg</span>, ncol <span class="op">=</span> <span class="fl">2</span>, top <span class="op">=</span> <span class="st">"CORRELACIONES"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="RstarS_files/figure-html/unnamed-chunk-338-1.png" width="672"></div>
</div>
</div>
<div id="materiales-para-realizar-las-prácticas-del-capítulo.-3" class="section level2" number="5.4">
<h2>
<span class="header-section-number">5.4</span> Materiales para realizar las prácticas del capítulo.<a class="anchor" aria-label="anchor" href="#materiales-para-realizar-las-pr%C3%A1cticas-del-cap%C3%ADtulo.-3"><i class="fas fa-link"></i></a>
</h2>
<p>En esta sección se muestran los links de acceso a los diferentes materiales (scripts, datos…) necesarios para llevar a cabo los contenidos prácticos del capítulo.</p>
<p><strong>Datos (en formato Microsoft (R) Excel (R)):</strong></p>
<ul>
<li>eolica_100_mv.xlsx (<a href="https://docs.google.com/spreadsheets/d/1f9KV5epNpBRM6v9sKPtgFDkzMlOo75Y2/edit?usp=sharing&amp;ouid=115375878280465826079&amp;rtpof=true&amp;sd=true">obtener aquí</a>)</li>
</ul>
<p><strong>Scripts:</strong></p>
<ul>
<li>explora_describe.R (<a href="https://drive.google.com/file/d/1VqZX81h15JZhF7KXXj3alLd08o5ywkX2/view?usp=sharing">obtener aquí</a>)</li>
</ul>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="estad%C3%ADstica-descriptiva..html"><span class="header-section-number">4</span> Estadística descriptiva.</a></div>
<div class="next"><a href="componentes-principales..html"><span class="header-section-number">6</span> Componentes principales.</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#an%C3%A1lisis-previo-de-datos."><span class="header-section-number">5</span> Análisis previo de datos.</a></li>
<li><a class="nav-link" href="#introducci%C3%B3n.-1"><span class="header-section-number">5.1</span> Introducción.</a></li>
<li>
<a class="nav-link" href="#an%C3%A1lisis-de-una-variable."><span class="header-section-number">5.2</span> Análisis de una variable.</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#buscando-missing-values-y-outliers."><span class="header-section-number">5.2.1</span> Buscando missing values y outliers.</a></li>
<li><a class="nav-link" href="#descripci%C3%B3n-de-una-variable."><span class="header-section-number">5.2.2</span> Descripción de una variable.</a></li>
<li><a class="nav-link" href="#normalidad."><span class="header-section-number">5.2.3</span> Normalidad.</a></li>
<li><a class="nav-link" href="#resumen-los-4-gr%C3%A1ficos-b%C3%A1sicos-en-la-descripci%C3%B3n-de-una-variable."><span class="header-section-number">5.2.4</span> Resumen: los 4 gráficos básicos en la descripción de una variable.</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#an%C3%A1lisis-de-m%C3%BAltiples-variables."><span class="header-section-number">5.3</span> Análisis de múltiples variables.</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#localizaci%C3%B3n-de-missing-values-y-outliers."><span class="header-section-number">5.3.1</span> Localización de missing values y outliers.</a></li>
<li><a class="nav-link" href="#correlaci%C3%B3n-entre-variables."><span class="header-section-number">5.3.2</span> Correlación entre variables.</a></li>
</ul>
</li>
<li><a class="nav-link" href="#materiales-para-realizar-las-pr%C3%A1cticas-del-cap%C3%ADtulo.-3"><span class="header-section-number">5.4</span> Materiales para realizar las prácticas del capítulo.</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>R-Stars: La Guía</strong>" was written by Miguel-Ángel Tarancón. It was last built on 2025-09-15.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
